{"commits": [{"oid": "34849da75aafbcfa04a8e897737c1e76f640444e", "id": "read-symbolic-ref", "title": "data: Implement symbolic refs idea", "message": "<p>If the file that represents a ref contains an OID, we'll assume that the ref points to an OID. If the file contains the content <code>ref: &lt;refname&gt;</code>, we'll assume that the ref points to <refname> and we will dereference it recursively.</p>\n", "diff": {"ugit/data.py": {"changed_lines": [22, 25, 26, 27, 28, 29, 30], "hunks": [{"title": "@@ -19,9 +19,15 @@ def update_ref (ref, oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"19\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"20\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"21\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"22\"><span class=\"d-s\">+ </span>    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"23\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"24\"><span class=\"d-s\">  </span>        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"25\"><span class=\"d-s\">- </span>            <span class=\"k\">return</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"25\"><span class=\"d-s\">+ </span>            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"26\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"27\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"28\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">())</span>\n</span><span class=\"line d-a\" data-line=\"29\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"30\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"31\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"32\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"33\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "7a24597f4f59238f28c455fd75abff7efbad6a4c", "ugit/cli.py": "177117f2367f2d90a802260572662cf3661b5c08", "ugit/data.py": "42df78660177eac27b43a2af8eec3aae1a22f989"}}, {"oid": "b7b8b8eac22108daa5b3c959e83f6089461c0c70", "id": "create-refvalue", "title": "data: Create RefValue container", "message": "<p>To make working with symbolic refs easier, we will create a <code>RefValue</code> container to represent the value of a ref. <code>RefValue</code> will have a property <code>symbolic</code> that will say whether it's a symbolic or a direct ref.</p>\n<p>This change is just refactoring, we will wrap every OID that is written or read from a ref is a <code>RefValue</code>.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [78, 87, 95, 99, 103, 154, 155], "hunks": [{"title": "@@ -75,7 +75,7 @@ def read_tree (tree_oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"75\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"76\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"77\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"78\"><span class=\"d-s\">- </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"78\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"79\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"80\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span></code></pre></div>\n"}, {"title": "@@ -84,7 +84,7 @@ def commit (message):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"84\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"85\"><span class=\"d-s\">  </span>    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"87\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"87\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"88\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"89\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span></code></pre></div>\n"}, {"title": "@@ -92,15 +92,15 @@ def commit (message):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"92\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"94\"><span class=\"d-s\">  </span>    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"95\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"95\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"97\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"98\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"99\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"99\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"100\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"101\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"102\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"103\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"103\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"104\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"105\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"106\"><span class=\"d-s\">  </span><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span></code></pre></div>\n"}, {"title": "@@ -151,8 +151,8 @@ def get_oid (name):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"151\"><span class=\"d-s\">  </span>        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"152\"><span class=\"d-s\">  </span>    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"153\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"154\"><span class=\"d-s\">- </span>        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"154\"><span class=\"d-s\">- </span>            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"154\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"155\"><span class=\"d-s\">+ </span>            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"156\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"157\"><span class=\"d-s\">  </span>    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"158\"><span class=\"d-s\">  </span>    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [123, 124], "hunks": [{"title": "@@ -120,8 +120,8 @@ def k (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"120\"><span class=\"d-s\">  </span>    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"121\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"122\"><span class=\"d-s\">  </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-r\" data-line=\"123\"><span class=\"d-s\">- </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-r\" data-line=\"123\"><span class=\"d-s\">- </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"123\"><span class=\"d-s\">+ </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"124\"><span class=\"d-s\">+ </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"125\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"126\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}, "ugit/data.py": {"changed_lines": [4, 14, 15, 16, 17, 18, 22, 35], "hunks": [{"title": "@@ -1,6 +1,7 @@", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"d-s\">  </span><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"d-s\">  </span><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"4\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"6\"><span class=\"d-s\">  </span><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span></code></pre></div>\n"}, {"title": "@@ -10,11 +11,15 @@ def init ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"11\"><span class=\"d-s\">  </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"13\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"14\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"14\"><span class=\"d-s\">+ </span><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line d-a\" data-line=\"15\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"16\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"17\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"18\"><span class=\"d-s\">+ </span>    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line\" data-line=\"19\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"20\"><span class=\"d-s\">  </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\"><span class=\"d-s\">  </span>    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"22\"><span class=\"d-s\">- </span>        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"22\"><span class=\"d-s\">+ </span>        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"23\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"24\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"25\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}, {"title": "@@ -27,7 +32,7 @@ def get_ref (ref):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"32\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"33\"><span class=\"d-s\">  </span>        <span class=\"k\">return</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"34\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"35\"><span class=\"d-s\">- </span>    <span class=\"k\">return</span> <span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"35\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"37\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"38\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "852df6bee81a6ae84127cffbb96413f4682c21b0", "ugit/cli.py": "9275edee44934ec26f86534d46656487b1bee2c9", "ugit/data.py": "4397d4a208c4558a988e729a3db9ac55e3c94b0d"}}, {"oid": "d760695c83860fbaecd85449b9414b2bdcbc7214", "id": "deref-symbolic-refs-on-write", "title": "data: Dereference refs when reading and writing", "message": "<p>Now we'll dereference symbolic refs not only when reading them but also when writing them.</p>\n<p>We'll implement a helper function called <code>_get_ref_internal</code> which will return the path and the value of the last ref pointed by a symbolic ref. In simple words:</p>\n<ul>\n<li>When given a non-symbolic ref, <code>_get_ref_internal</code> will return the ref name and value.</li>\n<li>When given a symbolic ref, <code>_get_ref_internal</code> will dereference the ref recursively, and then return the name of the last (non-symbolic) ref that points to an OID, plus its value.</li>\n</ul>\n<p>Now <code>update_ref</code> will use <code>_get_ref_internal</code> to know which ref it needs to update.</p>\n<p>Additionaly, we'll use <code>_get_ref_internal</code> in <code>get_ref</code>.</p>\n", "diff": {"ugit/data.py": {"changed_lines": [19, 27, 28, 29, 30, 37, 38, 39, 40, 42], "hunks": [{"title": "@@ -16,6 +16,7 @@ RefValue = namedtuple ('RefValue', ['symbolic', 'value'])", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"16\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"17\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line d-a\" data-line=\"19\"><span class=\"d-s\">+ </span>    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"20\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\"><span class=\"d-s\">  </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"22\"><span class=\"d-s\">  </span>    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span></code></pre></div>\n"}, {"title": "@@ -23,16 +24,22 @@ def update_ref (ref, value):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"24\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"25\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"26\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"27\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line d-a\" data-line=\"28\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"29\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"30\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"32\"><span class=\"d-s\">  </span>    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"33\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"34\"><span class=\"d-s\">  </span>        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"35\"><span class=\"d-s\">  </span>            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"36\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"37\"><span class=\"d-s\">- </span>    <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"37\"><span class=\"d-s\">- </span>        <span class=\"k\">return</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">())</span>\n</span><span class=\"line d-a\" data-line=\"37\"><span class=\"d-s\">+ </span>    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"38\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"39\"><span class=\"d-s\">+ </span>        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"40\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"42\"><span class=\"d-s\">- </span>    <span class=\"k\">return</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"42\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"44\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"45\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "852df6bee81a6ae84127cffbb96413f4682c21b0", "ugit/cli.py": "9275edee44934ec26f86534d46656487b1bee2c9", "ugit/data.py": "1b83cf2f9b586da28b2f031e22e8fe2c00e35b4a"}}, {"oid": "5075c62e8786c50a4f26d480ee640d692565fa33", "id": "make-dereference-optional", "title": "data: Don't always dereference refs (for `ugit k`)", "message": "<p>Actually, it's not always desirable to dereference a ref all the way. Sometimes we would like to know at which ref a symbolic ref points, rather than the final OID. Or we would like to update a ref directly, rather then updating the last ref in the chain.</p>\n<p>One such usecase is <code>ugit k</code>. When visualizing refs it would be nice to see which ref points to which ref. We will see another usecase soon.</p>\n<p>To accomodate this, we will add a <code>deref</code> option to <code>get_ref</code>, <code>iter_refs</code> and <code>update_ref</code>. If they will be called with <code>deref=False</code>, they will work on the raw value of a ref and not dereference any symbolic refs.</p>\n<p>Then we will update <code>k</code> to use <code>deref=False</code>.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [154], "hunks": [{"title": "@@ -151,7 +151,7 @@ def get_oid (name):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"151\"><span class=\"d-s\">  </span>        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"152\"><span class=\"d-s\">  </span>    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"153\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"154\"><span class=\"d-s\">- </span>        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"154\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"155\"><span class=\"d-s\">  </span>            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"156\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"157\"><span class=\"d-s\">  </span>    <span class=\"c1\"># Name is SHA1</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [121, 124, 125], "hunks": [{"title": "@@ -118,10 +118,11 @@ def k (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"118\"><span class=\"d-s\">  </span>    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"120\"><span class=\"d-s\">  </span>    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line d-r\" data-line=\"121\"><span class=\"d-s\">- </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"121\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"122\"><span class=\"d-s\">  </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"123\"><span class=\"d-s\">  </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-r\" data-line=\"124\"><span class=\"d-s\">- </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"124\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"125\"><span class=\"d-s\">+ </span>            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"127\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}, "ugit/data.py": {"changed_lines": [17, 19, 26, 27, 30, 40, 41, 46, 53], "hunks": [{"title": "@@ -14,20 +14,20 @@ def init ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"14\"><span class=\"d-s\">  </span><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"16\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"17\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"17\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line d-r\" data-line=\"19\"><span class=\"d-s\">- </span>    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line d-a\" data-line=\"19\"><span class=\"d-s\">+ </span>    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"20\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\"><span class=\"d-s\">  </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"22\"><span class=\"d-s\">  </span>    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"23\"><span class=\"d-s\">  </span>        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"25\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"26\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"26\"><span class=\"d-s\">- </span>    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line d-a\" data-line=\"26\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"27\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"28\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"29\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"30\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"30\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"32\"><span class=\"d-s\">  </span>    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"33\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}, {"title": "@@ -37,19 +37,20 @@ def _get_ref_internal (ref):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"37\"><span class=\"d-s\">  </span>    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"39\"><span class=\"d-s\">  </span>        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line d-r\" data-line=\"40\"><span class=\"d-s\">- </span>        <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"40\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"n\">deref</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"41\"><span class=\"d-s\">+ </span>            <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"43\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"45\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"46\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"46\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"47\"><span class=\"d-s\">  </span>    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"48\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\"><span class=\"d-s\">  </span>        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\"><span class=\"d-s\">  </span>        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"52\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"53\"><span class=\"d-s\">- </span>        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"53\"><span class=\"d-s\">+ </span>        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"55\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"56\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "ce8586b2d96df309dbadb0ef3e5ea7b0bd2239c3", "ugit/cli.py": "c8f523fff753ccff342dca66fc34d5b6eee57465", "ugit/data.py": "f9661c1c977e702b4b4d1c204befe2a95365a658"}}, {"oid": "6c10d34d9d6aabde9bf86e8977dd5a43dff4c018", "id": "write-symbolic-refs", "title": "data: Write symbolic refs", "message": "<p>We have one last step before we can finally implement branching. We will add code to <code>update_ref</code> that can write a symbolic value.</p>\n<p>Note: In a previous change we implemented the ability to write to a symbolic ref, but we could only write <strong>OIDs</strong> to it. Now we implemeted the ability to write a <strong>symbolic value</strong> to a ref (and it doesn't matter if the ref that we write is itself symbolic or non-symbolic). These two sound similar and confusing, but make sure that you pause and understand why these are different things.</p>\n", "diff": {"ugit/data.py": {"changed_lines": [19, 20, 21, 22, 23, 24, 25, 29], "hunks": [{"title": "@@ -15,12 +15,18 @@ RefValue = namedtuple ('RefValue', ['symbolic', 'value'])", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"15\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"16\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"17\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"18\"><span class=\"d-s\">- </span>    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line d-a\" data-line=\"19\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"20\"><span class=\"d-s\">+ </span>    <span class=\"k\">assert</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"21\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"22\"><span class=\"d-s\">+ </span>        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;ref: </span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"23\"><span class=\"d-s\">+ </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"24\"><span class=\"d-s\">+ </span>        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"25\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"26\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"27\"><span class=\"d-s\">  </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\"><span class=\"d-s\">  </span>    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"29\"><span class=\"d-s\">- </span>        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"29\"><span class=\"d-s\">+ </span>        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"31\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"32\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "ce8586b2d96df309dbadb0ef3e5ea7b0bd2239c3", "ugit/cli.py": "c8f523fff753ccff342dca66fc34d5b6eee57465", "ugit/data.py": "1867ff7486f43a355b3a370aa190f6ac930dce04"}}, {"oid": "38460cb49e18c2eaa30f30a68a416ef019c20d2b", "id": "checkout-switch-branches", "title": "checkout: Switch branches", "message": "<p>Finally! After this change, if we checkout a branch, we will point HEAD to the ref of that branch (making HEAD symbolic). If we check out anything else (such as a tag or an OID directly), we'll just point HEAD directly at the commit OID (making HEAD non-symbolic).</p>\n<p>We treat every ref under <em>refs/heads</em> as a branch.</p>\n<p>The behaviour described in the introduction of branches now works. We can make commits on a branch and it will advance along with HEAD. If we have this:</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O (3d8773...)\n                   \\                ^\n                    ----o---o    branch1\n                            ^\n                         branch2</code></pre>\n<p>(Assume that the OID of the last commit is 3d8773.) If we checkout the commit by branch name (<code>ugit checkout branch1</code>), HEAD will become a symbolic ref that points to the ref of <em>branch1</em>. The physical value of HEAD will be <code>ref: refs/heads/branch1</code>.</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O (3d8773...)\n                   \\                ^\n                    ----o---o    branch1 &lt;--- HEAD\n                            ^\n                         branch2</code></pre>\n<p>And if you create a commit, it will advance <em>branch1</em> together with HEAD:</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O-----o\n                   \\                      ^\n                    ----o---o          branch1 &lt;--- HEAD\n                            ^\n                      branch2</code></pre>\n<p>Note that we can checkout that same commit by its OID (<code>ugit checkout 3d8773</code> instead of <code>ugit checkout branch1</code>). This is actually a different thing!</p>\n<p>HEAD ultimately still points the same commit in both cases, but if we checkout the commit by OID , HEAD will point directly to OID <em>3d8773</em>:</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O (3d8773...)\n                   \\                ^\n                    ----o---o    branch1,HEAD\n                            ^\n                         branch2</code></pre>\n<p>The physical value of HEAD will be \"3d8773\". Now commits will NOT advance the <em>branch1</em>, only HEAD will advance:</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O-----o\n                   \\                ^     ^\n                    ----o---o    branch1  HEAD\n                            ^\n                         branch2</code></pre>\n<p>This situation is called <strong>detached HEAD</strong>. You might have heard about it when you were working with real Git. It's a confusing concept at first, but hopefully it's easier to enderstand now since we've build everything ourselves.</p>\n<p><strong>Detached HEAD</strong> is a bit of a dangerous situation to be in because you can lose some commits if you work in detached HEAD and then switch to another branch. For example imagine you do <code>ugit checkout branch2</code>:</p>\n<pre><code>o-----o-----o-----o-----o-----o-----O-----o\n                   \\                ^\n                    ----o---o    branch1\n                            ^\n                         branch2 &lt;--- HEAD</code></pre>\n<p>As you can see, no refs point to the latest commit that we've previousy made on top of <em>branch1</em>. You'll need to know its OID in order to retrieve it again, which is currently problematic if you don't remember it.</p>\n<p>So make sure you're never in detached HEAD state unless you intend to.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [92, 93, 96, 97, 98, 99, 100, 101, 102, 113, 114, 115, 116], "hunks": [{"title": "@@ -89,10 +89,17 @@ def commit (message):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"89\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"90\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"91\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"92\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"92\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"93\"><span class=\"d-s\">+ </span>    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"94\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"95\"><span class=\"d-s\">  </span>    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"96\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"96\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"97\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"98\"><span class=\"d-s\">+ </span>        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"99\"><span class=\"d-s\">+ </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"100\"><span class=\"d-s\">+ </span>        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"101\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"102\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"104\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"105\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}, {"title": "@@ -103,6 +110,10 @@ def create_branch (name, oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"110\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"111\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"112\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"113\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"114\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line d-a\" data-line=\"115\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"116\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"117\"><span class=\"d-s\">  </span><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"118\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [51, 105], "hunks": [{"title": "@@ -48,7 +48,7 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"48\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"49\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"51\"><span class=\"d-s\">- </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"51\"><span class=\"d-s\">+ </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"53\"><span class=\"d-s\">  </span>    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\"><span class=\"d-s\">  </span>    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}, {"title": "@@ -102,7 +102,7 @@ def log (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"102\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"103\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"104\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"105\"><span class=\"d-s\">- </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"105\"><span class=\"d-s\">+ </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"107\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"108\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "69b9f56416a82199a8a211e919d0b97fbe36bcf0", "ugit/cli.py": "af4874e12407854d4587003b5598cd35a48b4453", "ugit/data.py": "1867ff7486f43a355b3a370aa190f6ac930dce04"}}, {"oid": "cd7205f99a6406b71b97516cc89828d3b6628752", "id": "init-head-to-master", "title": "init: Set HEAD to master on init", "message": "<p>We will make HEAD point to a ref <em>refs/heads/master</em> so that the repository has an initial branch, called <em>master</em> (meaning the main branch). The branch could have been named anything we'd like but <em>master</em> is the standard name used for the first branch in Git.</p>\n<p>Without this change, a fresh ugit repository would have started in detached HEAD, but now we'll have branch right from the start to save the user some typing and confusion.</p>\n<p>Note that now we'll have 2 init functions: One in <em>base.py</em> and one in <em>data.py</em>. <code>base.init()</code> calls <code>data.init()</code> and each initializes a different aspect of the repository. As you remember, <em>data.py</em> handles everything that directly touches the disk (object database and refs) and <em>base.py</em> handles the higher-level concepts built on top of <em>data.py</em>. Because \"setting an initial branch\" is a higher-level concept, its initialization belongs in <em>base.py</em>.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [11, 12, 13, 14, 15], "hunks": [{"title": "@@ -8,6 +8,11 @@ from collections import deque, namedtuple", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"8\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"10\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"11\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"12\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"13\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"14\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"15\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"16\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\"><span class=\"d-s\">  </span>    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [70], "hunks": [{"title": "@@ -67,7 +67,7 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"67\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"68\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"69\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"70\"><span class=\"d-s\">- </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"70\"><span class=\"d-s\">+ </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"71\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"72\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"73\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "734522afdee74da6dbbaf89a793c34e66213579a", "ugit/cli.py": "242794fc415197b5a712bd7a6177922618ebaf57", "ugit/data.py": "1867ff7486f43a355b3a370aa190f6ac930dce04"}}, {"oid": "34f2f8f7865e58a565cd71f9f1a6f963f2fc3ae6", "id": "status-print-branch", "title": "status: Print current branch name", "message": "<p>Let's create a new CLI command <code>status</code>. Generally, this command will print useful information about our working directory.</p>\n<p>Right now I want to create it so that it will print the current branch name. In later changes we'll print more interesting information (such as which files were changed).</p>\n", "diff": {"ugit/base.py": {"changed_lines": [122, 123, 124, 125, 126, 127, 128, 129, 130], "hunks": [{"title": "@@ -119,6 +119,15 @@ def is_branch (branch):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"119\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"120\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"121\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"122\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"123\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"124\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"125\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line d-a\" data-line=\"126\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"127\"><span class=\"d-s\">+ </span>    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"128\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"129\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"130\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"131\"><span class=\"d-s\">  </span><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"132\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [66, 67, 68, 143, 144, 145, 146, 147, 148, 149, 150, 151], "hunks": [{"title": "@@ -63,6 +63,9 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"63\"><span class=\"d-s\">  </span>    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\"><span class=\"d-s\">  </span>    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"66\"><span class=\"d-s\">+ </span>    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"67\"><span class=\"d-s\">+ </span>    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"68\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"69\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"70\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}, {"title": "@@ -137,3 +140,12 @@ def k (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"140\"><span class=\"d-s\">  </span>            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"141\"><span class=\"d-s\">  </span>            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"142\"><span class=\"d-s\">  </span>        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line d-a\" data-line=\"143\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"144\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"145\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"146\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"147\"><span class=\"d-s\">+ </span>    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"148\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"149\"><span class=\"d-s\">+ </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"150\"><span class=\"d-s\">+ </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"151\"><span class=\"d-s\">+ </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "0be68325c8425745cb8c7400e496ee9aee1ebb6f", "ugit/cli.py": "5eadb8c8aaaa32bfe7d84b248e7933a0bd76b64b", "ugit/data.py": "1867ff7486f43a355b3a370aa190f6ac930dce04"}}, {"oid": "c13405a651dc1e0a951bd67bd9e937d6130076ba", "id": "show-all-branches", "title": "branch: Show all branches", "message": "<p>Previosuly, <code>branch</code> only created new branches. For user convenience, we'll extend <code>branch</code> to list all existing branches when the user runs it without arguments.</p>\n<p>Additionaly, we'll print an asterisk next to the current branch.</p>\n<p>To implement this functionality, we need a way to iterate over all branches. We already have <code>data.iter_refs</code> which iterates over all refs, and branches are just refs that live under <em>refs/heads/</em> namespace. Let's add a prefix argument to <code>data.iter_refs</code> so that the caller can restrict which refs it will get.</p>\n<p>Then we will implement <code>base.iter_branch_names</code>, which will iterate over all branch refs (like <em>refs/heads/master</em>) and output just the name of the branch (like <em>master</em>).</p>\n<p>Finally, we'll make the parameters to the CLI <code>branch</code> command optional and print all branches when the user runs <code>ugit branch</code>.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [118, 119, 120, 121, 122], "hunks": [{"title": "@@ -115,6 +115,11 @@ def create_branch (name, oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"115\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"116\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"117\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"118\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"119\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"120\"><span class=\"d-s\">+ </span>        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"121\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"122\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"123\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"124\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [60, 116, 117, 118, 119, 120, 121, 122, 123], "hunks": [{"title": "@@ -57,7 +57,7 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"57\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"58\"><span class=\"d-s\">  </span>    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\"><span class=\"d-s\">  </span>    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"60\"><span class=\"d-s\">- </span>    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"60\"><span class=\"d-s\">+ </span>    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\"><span class=\"d-s\">  </span>    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"63\"><span class=\"d-s\">  </span>    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}, {"title": "@@ -113,8 +113,14 @@ def tag (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"113\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"114\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"115\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"116\"><span class=\"d-s\">- </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"116\"><span class=\"d-s\">- </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"116\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"117\"><span class=\"d-s\">+ </span>        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"118\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"119\"><span class=\"d-s\">+ </span>            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line d-a\" data-line=\"120\"><span class=\"d-s\">+ </span>            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"121\"><span class=\"d-s\">+ </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"122\"><span class=\"d-s\">+ </span>        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"123\"><span class=\"d-s\">+ </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"125\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"126\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}, "ugit/data.py": {"changed_lines": [52, 59, 60], "hunks": [{"title": "@@ -49,13 +49,15 @@ def _get_ref_internal (ref, deref):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"49\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"51\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"52\"><span class=\"d-s\">- </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"52\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"53\"><span class=\"d-s\">  </span>    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"54\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"55\"><span class=\"d-s\">  </span>        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\"><span class=\"d-s\">  </span>        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"58\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"59\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">refname</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"60\"><span class=\"d-s\">+ </span>            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"61\"><span class=\"d-s\">  </span>        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "04eb7495a50d920a8640a90fdf1dc779b4a5f15a", "ugit/cli.py": "d9e4b18debbb949ce1ca6b722b0465d7c4be41ff", "ugit/data.py": "44f12f8a8017fd65f1c543ffaa11dbe091e71539"}}, {"oid": "3b73acdd3e26ead31d03ba30a08e73da70afdada", "id": "annotate-log", "title": "log: Show refs that point to each commit", "message": "<p>This is another user convenience feature. Let's modify <code>log</code> to print refs next to commits, so that for each commit that is printed we will additionally print all refs that point to that commit.</p>\n<p>First let's build a reverse lookup dictionary, from a commit OID to the refs that reference it.</p>\n<p>Then for each commit we will print the refs next to the OID.</p>\n", "diff": {"ugit/cli.py": {"changed_lines": [99, 100, 101, 102, 106, 107], "hunks": [{"title": "@@ -96,10 +96,15 @@ def commit (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"96\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"97\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"98\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"99\"><span class=\"d-s\">+ </span>    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line d-a\" data-line=\"100\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"101\"><span class=\"d-s\">+ </span>        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"102\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"103\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"104\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"105\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"106\"><span class=\"d-s\">- </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"106\"><span class=\"d-s\">+ </span>        <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line d-a\" data-line=\"107\"><span class=\"d-s\">+ </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\"><span class=\"d-s\">  </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"109\"><span class=\"d-s\">  </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "04eb7495a50d920a8640a90fdf1dc779b4a5f15a", "ugit/cli.py": "fd5e263ee89b0a8c0799d059ef400f80f1e3d2f4", "ugit/data.py": "44f12f8a8017fd65f1c543ffaa11dbe091e71539"}}], "objects": {"42df78660177eac27b43a2af8eec3aae1a22f989": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\">\n</span><span class=\"line\" data-line=\"5\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"9\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"15\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"17\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"22\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"23\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"24\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"25\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\">    <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"28\">        <span class=\"k\">return</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"k\">return</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"36\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"47\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"49\">\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "852df6bee81a6ae84127cffbb96413f4682c21b0": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"14\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"15\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"16\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"21\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"23\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"24\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"29\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"30\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"36\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"39\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"47\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"49\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"50\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"54\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"56\">\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"61\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"63\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"64\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"70\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"80\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">\n</span><span class=\"line\" data-line=\"98\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"115\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"117\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"118\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"119\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"120\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"121\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"133\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"134\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"135\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">\n</span><span class=\"line\" data-line=\"143\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"144\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"145\">\n</span><span class=\"line\" data-line=\"146\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"149\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"154\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"155\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"163\">\n</span><span class=\"line\" data-line=\"164\">\n</span><span class=\"line\" data-line=\"165\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"166\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "9275edee44934ec26f86534d46656487b1bee2c9": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"124\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"130\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"131\">\n</span><span class=\"line\" data-line=\"132\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"136\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"137\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"138\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span></code></pre></div>\n", "4397d4a208c4558a988e729a3db9ac55e3c94b0d": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"30\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"33\">        <span class=\"k\">return</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">    <span class=\"k\">return</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">\n</span><span class=\"line\" data-line=\"56\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"59\">\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"62\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "1b83cf2f9b586da28b2f031e22e8fe2c00e35b4a": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"22\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"23\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"28\">\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\"><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"34\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"35\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"39\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"48\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"58\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "ce8586b2d96df309dbadb0ef3e5ea7b0bd2239c3": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"14\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"15\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"16\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"21\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"23\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"24\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"29\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"30\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"36\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"39\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"47\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"49\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"50\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"54\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"56\">\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"61\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"63\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"64\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"70\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"80\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">\n</span><span class=\"line\" data-line=\"98\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"115\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"117\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"118\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"119\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"120\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"121\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"133\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"134\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"135\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">\n</span><span class=\"line\" data-line=\"143\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"144\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"145\">\n</span><span class=\"line\" data-line=\"146\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"149\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"154\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"155\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"163\">\n</span><span class=\"line\" data-line=\"164\">\n</span><span class=\"line\" data-line=\"165\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"166\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "c8f523fff753ccff342dca66fc34d5b6eee57465": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"124\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"125\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"131\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"134\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"137\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"138\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span></code></pre></div>\n", "f9661c1c977e702b4b4d1c204befe2a95365a658": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"22\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"23\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"28\">\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\"><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"34\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"35\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"39\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">if</span> <span class=\"n\">deref</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">            <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">\n</span><span class=\"line\" data-line=\"46\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">\n</span><span class=\"line\" data-line=\"52\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">\n</span><span class=\"line\" data-line=\"56\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"73\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "1867ff7486f43a355b3a370aa190f6ac930dce04": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"k\">assert</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;ref: </span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"23\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"24\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"29\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\"><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">if</span> <span class=\"n\">deref</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"47\">            <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">\n</span><span class=\"line\" data-line=\"52\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"55\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">\n</span><span class=\"line\" data-line=\"70\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"79\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "69b9f56416a82199a8a211e919d0b97fbe36bcf0": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"14\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"15\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"16\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"21\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"23\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"24\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"29\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"30\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"36\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"39\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"47\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"49\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"50\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"54\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"56\">\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"61\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"63\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"64\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"70\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"80\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"125\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"126\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"130\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"136\">\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"140\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"143\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"145\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"146\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"155\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"159\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"161\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"162\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"163\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"166\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"170\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"171\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"172\">\n</span><span class=\"line\" data-line=\"173\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "af4874e12407854d4587003b5598cd35a48b4453": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"124\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"125\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"131\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"134\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"137\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"138\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span></code></pre></div>\n", "734522afdee74da6dbbaf89a793c34e66213579a": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"77\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"85\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"104\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"105\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">\n</span><span class=\"line\" data-line=\"122\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"127\">\n</span><span class=\"line\" data-line=\"128\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"133\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"134\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"135\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"137\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"140\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">\n</span><span class=\"line\" data-line=\"143\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"144\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"146\">\n</span><span class=\"line\" data-line=\"147\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"149\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"150\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"152\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"156\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"157\">\n</span><span class=\"line\" data-line=\"158\">\n</span><span class=\"line\" data-line=\"159\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"160\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"163\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"166\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"167\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"168\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"170\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"171\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"172\">\n</span><span class=\"line\" data-line=\"173\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"174\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"175\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"176\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"177\">\n</span><span class=\"line\" data-line=\"178\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"179\">\n</span><span class=\"line\" data-line=\"180\">\n</span><span class=\"line\" data-line=\"181\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"182\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "242794fc415197b5a712bd7a6177922618ebaf57": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"124\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"125\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"131\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"134\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"137\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"138\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span></code></pre></div>\n", "0be68325c8425745cb8c7400e496ee9aee1ebb6f": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"77\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"85\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"104\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"105\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">\n</span><span class=\"line\" data-line=\"122\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"125\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"136\">\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"141\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"142\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"143\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"144\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"145\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"146\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"150\">\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"157\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"158\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"159\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"161\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"162\">\n</span><span class=\"line\" data-line=\"163\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"172\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"173\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"174\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"175\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"176\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"178\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"181\">\n</span><span class=\"line\" data-line=\"182\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"183\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"184\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"185\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"188\">\n</span><span class=\"line\" data-line=\"189\">\n</span><span class=\"line\" data-line=\"190\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"191\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "5eadb8c8aaaa32bfe7d84b248e7933a0bd76b64b": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"78\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">\n</span><span class=\"line\" data-line=\"98\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"104\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"108\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"116\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"126\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">\n</span><span class=\"line\" data-line=\"130\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"133\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"134\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"140\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"141\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"142\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"148\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"149\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "04eb7495a50d920a8640a90fdf1dc779b4a5f15a": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"75\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"77\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"85\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"100\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"104\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"105\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"120\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"121\">\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"128\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"132\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"140\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"143\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"144\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"145\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"146\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"147\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"149\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"151\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"162\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"163\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"164\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"166\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"170\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"171\">\n</span><span class=\"line\" data-line=\"172\">\n</span><span class=\"line\" data-line=\"173\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"174\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"178\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"180\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"181\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"182\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"183\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"184\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"185\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"188\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"190\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"191\">\n</span><span class=\"line\" data-line=\"192\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"193\">\n</span><span class=\"line\" data-line=\"194\">\n</span><span class=\"line\" data-line=\"195\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"196\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "d9e4b18debbb949ce1ca6b722b0465d7c4be41ff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"78\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">\n</span><span class=\"line\" data-line=\"98\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"100\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"104\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"108\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"116\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"117\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"118\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"119\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"120\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"133\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"134\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"137\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"139\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"140\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"143\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"146\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"147\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"149\">\n</span><span class=\"line\" data-line=\"150\">\n</span><span class=\"line\" data-line=\"151\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"155\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"156\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"157\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "44f12f8a8017fd65f1c543ffaa11dbe091e71539": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"k\">assert</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;ref: </span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"23\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"24\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"29\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\"><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">if</span> <span class=\"n\">deref</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"47\">            <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">\n</span><span class=\"line\" data-line=\"52\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"55\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">refname</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"60\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"61\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"68\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"74\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">first_null</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[:</span><span class=\"n\">first_null</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"78\">    <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"p\">[</span><span class=\"n\">first_null</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">:]</span>\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"81\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n", "fd5e263ee89b0a8c0799d059ef400f80f1e3d2f4": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"20\">\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"78\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">\n</span><span class=\"line\" data-line=\"98\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"99\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"100\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"101\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"104\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\">        <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"109\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"124\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"125\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"132\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"137\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"138\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"139\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"145\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"146\">\n</span><span class=\"line\" data-line=\"147\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"148\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">\n</span><span class=\"line\" data-line=\"150\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"151\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"152\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"153\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"154\">\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"157\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"161\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"162\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}}